{% extends "./index.njk" %}

{% block provider_content %}
  {% if permissions.gateway_credentials_update %}
    <form id="credentials-form" method="post" action="{{ formatAccountPathsFor(routes.account.credentials.index, currentGatewayAccount.external_id) }}" autocomplete="off">
      <input id="csrf" name="csrfToken" type="hidden" value="{{csrf}}" />

      {% if change === 'merchantId' %}
        {{ govukInput({
            label: {
              text: "Merchant code"
            },
            id: "merchantId",
            name: "merchantId",
            classes: "govuk-input--width-20",
            type: "text",
            attributes: {
              "data-validate": "required",
              "autocomplete": "new-" + paymentProvider + "-merchantid"
            },
            value: currentGatewayAccount.credentials.merchant_id
          })
        }}
      {% else %}
        {{ govukInput({
            label: {
              text: "Merchant code"
            },
            id: "merchantId",
            name: "merchantId",
            classes: "govuk-input--width-20",
            type: "text",
            attributes: {
              "autocomplete": "new-" + targetProvider + "-merchantid"
            },
            value: currentGatewayAccount.credentials.merchant_id
          })
        }}
      {% endif %}

      {% if change === 'username' %}
        {{ govukInput({
            label: {
              text: "Username"
            },
            id: "username",
            name: "username",
            classes: "govuk-input--width-20",
            type: "text",
            attributes: {
              "autocomplete": "new-" + targetProvider + "-usernmae"
            },
            value: currentGatewayAccount.credentials.username
          })
        }}
      {% else %}
        {{ govukInput({
            label: {
              text: "Username"
            },
            id: "username",
            name: "username",
            classes: "govuk-input--width-20",
            type: "text",
            attributes: {
              "data-validate": "required",
              "autocomplete": "new-" + targetProvider + "-usernmae"
            },
            value: currentGatewayAccount.credentials.username
          })
        }}
      {% endif %}

      {% if change === 'password' %}
        {{ govukInput({
            label: {
              text: "Password"
            },
            id: "password",
            name: "password",
            classes: "govuk-input--width-20",
            type: "password",
            attributes: {
              "readonly": "readonly",
              "on-focus": "readonly onfocus='this.removeAttribute(\'readonly\');'",
              "data-validate": "required",
              "autocomplete": "new-" + targetProvider + "-password"
            }
          })
        }}
        {% else %}
        {{ govukInput({
            label: {
              text: "Password"
            },
            id: "password",
            name: "password",
            classes: "govuk-input--width-20",
            type: "password",
            attributes: {
              "readonly": "readonly",
              "on-focus": "readonly onfocus='this.removeAttribute(\'readonly\');'",
              "data-validate": "required",
              "autocomplete": "new-" + targetProvider + "-password"
            }
          })
        }}
      {% endif %}

      {{
        govukButton({
          text: "Save credentials",
          attributes: {
            id: "submitCredentials"
          }
        })
      }}
    </form>

    <script>
      setTimeout(() => {
        document.querySelectorAll('form').forEach(form => form.autocomplete = "off")
        document.querySelectorAll('input').forEach(input => input.autocomplete = "off")
        document.querySelectorAll('form').forEach(form => form.reset())
      }, 0)
    </script>

    <p class="govuk-body">
      <a class="govuk-link govuk-link--no-visited-state" href="{{ formatAccountPathsFor(routes.account.yourPsp.index, currentGatewayAccount.external_id, 'worldpay') }}">Cancel</a>
    </p>
  {% endif %}
{% endblock %}
